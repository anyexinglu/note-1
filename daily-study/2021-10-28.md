# 如何更好的记录渠道来源

在做业务的时候，产品同学经常需要统计需求上线后带来的收益如何，那么产品就可能会去统计对应的埋点信息。

比如某个需求产品同学希望在高流量的页面增加一个引流的入口，跳转到相应的页面。通常的做法是给相应的入口增加埋点信息，产品同学可以依据埋点的信息来统计
相关数据。

但是在某种场景下单单的埋点信息是无法做到的，比如我作为天猫的一个商家，我参加了一个活动，此时我想进行活动报名，活动报名的流程不仅仅是一个页面就能完成的，当
选择某个活动进行报名的时候可能会经过如下的一个流程：

```text
选择活动 -> 跳转到活动详情页 -> 选择对应的商品进行报名 -> 报名页 -> 报名成功页面
```

可以看出这是一个比较典型的漏斗模型，商家可能会在其中任何一个页面退出。

那么产品的增加的新的入口也是这个逻辑，可能会同样经历如下的一个流程:

```text
流量入口 -> 跳转到活动详情页 -> 选择对应的商品进行报名 -> 报名页 -> 报名成功页面
```

那么此时流量入口增加的埋点信息可能就不那么可靠了，因为增加报名入口的目的是为了提高报名量。虽然在入口增加了点击的埋点，但是在后续的流程中已经丢失了相关的
信息，对于产品来说想要准确的统计数据就会变的很难。

那么这样的问题应该如何解决呢？

## 约定每一个页面和每一个入口的一些枚举值

比如新增的流量入口是位于首页的，那么假设首页为 `p1` 作为唯一标识。那么流量入口假设为 `m1`，两个组合在一起就能确定模块以及当前模块的来源。
因此新增的流量入口的标志为 `p1-m1`, 可以把这个标志一直携带到最后的活动报名页，把相应的参数传递给后端，后端就可以进行统计信息。

因为如果用户点击了流量入口那么在现有的流程上携带参数就会是这样的:

```text
流量入口 -> 跳转到活动详情页(p1-m1) -> 选择对应的商品进行报名(p1-m1) -> 报名页(p1-m1) -> 报名成功页面(p1-m1)
```

那么这个方法有什么缺点呢？

- 每次`新增入口`或者是`新增页面`都要和后端一起约定新的枚举值，后续枚举值会越来越多，可能到项目足够大的时候就会引起爆炸。
- 当前的统计也只能统计到入口的流量引起的报名量。但是中间流程可能很难统计，比如想知道中间流程某个页面流式了多少，这个就会很难统计。

## 使用埋点的信息

因为对于产品做的任何一个需求想要查看其效果，都会对相应的部分进行埋点，通过埋点信息看需求上线后的效果如何。一般情况下埋点已经是足够了，但是在特殊的情况下
无法满足要求，比如类似活动这样的漏斗模型。针对这种漏斗模型是否有更好的办法来解决这个问题呢？

**使用埋点信息**

一般针对页面都有页面的埋点信息，比如流量入口所在的页面信息用字段 `pageSn` 表示，流量入口模块的埋点信息用字段 `eleSn` 表示，那么当点击`流量入口`的时候就会
生成这样的参数：

```text
sn={pageSn}.{eleSn}
```

将 `sn` 信息携带到下一个页面, 目前来说只有 sn 信息是不够的，比如对于商品列表这样的模块，每一个都是不一样的，因此最好在携带额外的参数。比如

```text
sn={pageSn}.{eleSn}.{goodsIndex}.{goodsId}
```

当然如果不是商品这种特殊的模块，则可以不用携带后面的参数。

假设目前的流程是这样的：

```text
点击流量入口 -> 详情页 -> 商品选择页 -> 报名页 -> 报名成功页
```

对应的 pageSn 和 eleSn 为

```text
{ pageSn: 1, eleSn: 2 } -> { pageSn: 2, eleSn: 1 } -> { pageSn: 3, eleSn: 1, goodsIndex: 0 } -> { pageSn: 4, eleSn: 1 } -> { pageSn: 5 }
```

通过这样的串联下来的 pageSn 以及相应的 eleSn 就可以生成一个完整的链条，从而可以根据完整的链条取得相应的数据。为了方便也可以一些字段比如 `refer_page` 总是指向上一个页面。

目前来说通过 `PageSn` 和 `eleSn` 已经把流程串了起来，这样可以很容易的统计到每个路径的量，对于报名的漏斗模型也很容易的进行统计。那么是否已经完全解决了问题了呢？

增加 `pageSn` 和 `eleSn` 目前能统计到页面入口进来，到报名成功的一个完整的流程。但是想统计报名成功的商品数据就变的很难统计，除非再传递额外的参数在报名的时候。这样对于数据团队来统计也是一个比较麻烦的事情，那是否可以针对特定的业务类型再把特定的参数透传下去从而解决问题呢？是可以的

比如流量入口的工具叫做短信，那么此时可以再透传一个参数叫做短信，同时配合 `pageSn` 和 `eleSn` 信息达到目的。
